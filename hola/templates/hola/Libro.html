{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Libros</title>
    <link rel="stylesheet" href="{% static 'css/estilos.css' %}">
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: url('https://images.unsplash.com/photo-1512820790803-83ca734da794?auto=format&fit=crop&w=1470&q=80') no-repeat center center fixed;
            background-size: cover;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding-top: 40px;
            color: #333;
        }
        .container {
            background: rgba(255, 255, 255, 0.9);
            width: 95%;
            max-width: 900px;
            padding: 25px;
            border-radius: 15px;
        }
        h1, h2 { text-align: center; color: #2c3e50; }
        form { margin-bottom: 25px; font-size: 18px; }
        .form-horizontal .form-row {
            display: flex; flex-wrap: wrap; gap: 15px; justify-content: space-between;
        }
        .form-horizontal .form-group {
            flex: 1 1 30%; min-width: 180px; display: flex; flex-direction: column;
        }
        input, select {
            height: 48px; font-size: 16px; border-radius: 10px; border: 1px solid #ccc; padding: 0 10px;
        }
        .guardar-btn {
            background: #28a745; color: white; font-size: 22px; font-weight: bold;
            border: none; border-radius: 12px; width: 100%; padding: 16px 0; cursor: pointer;
            margin-top: 15px; transition: 0.3s; display: block;
        }
        .guardar-btn:hover { background: #FF8C00; }
        .buscar-form { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .buscar-form input { width: 200px; height: 48px; font-size: 16px; border-radius: 10px; border: 1px solid #aaa; padding: 0 10px; }
        .buscar-btn { height: 48px; padding: 0 18px; font-size: 18px; font-weight: bold; background: #4CAF50; border-radius: 8px; cursor: pointer; color: #fff; border: none; }
        .buscar-btn:hover { background: #FF8C00; }
        ul { list-style: none; padding: 0; margin-top: 15px; }
        li { background-color: #f9f9f9; margin-bottom: 12px; padding: 15px; border-radius: 10px; font-size: 17px; border: 1px solid #eee; }
        li strong { font-size: 22px; }
        li span { font-size: 18px; }
        .estado-disponible { color: green; font-weight: bold; }
        .estado-no { color: red; font-weight: bold; }
        .back-link { display: block; text-align: center; margin-top: 20px; font-weight: bold; font-size: 30px; text-decoration: none; color: #4CAF50; }
        .back-link:hover { text-decoration: underline; }
        .error { color: red; font-size: 12px; }
        .boton-libro { padding: 10px 15px; border-radius: 8px; color: white; font-weight: bold; text-decoration: none; }
        .prestamo-btn { background: #007bff; }
        .reserva-btn { background: #ff9800; }
        .mensaje-no-disponible { color: red; font-weight: bold; font-size: 16px; margin-top: 10px; }
    </style>
</head>
<body>
<div class="container">
    <h1>üìö Libros</h1>

    {% if es_admin %}
    <form method="POST" class="form-horizontal">
        {% csrf_token %}
        <div class="form-row">
            {% for field in form %}
                <div class="form-group">
                    {{ field.label_tag }}
                    {{ field }}
                    {% if field.errors %}
                        <div class="error">{{ field.errors }}</div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        <button type="submit" class="guardar-btn">üíæ GUARDAR</button>
    </form>
    {% endif %}

    <h2>Buscar libros:</h2>
    <form method="get" class="buscar-form">
        <input type="text" name="titulo" placeholder="T√≠tulo" value="{{ request.GET.titulo }}">
        <input type="text" name="autor" placeholder="Autor" value="{{ request.GET.autor }}">
        <input type="text" name="categoria" placeholder="Categor√≠a" value="{{ request.GET.categoria }}">
        <button type="submit" class="buscar-btn">Buscar üîç</button>
    </form>

    <h2>Lista de libros</h2>
    <ul>
        {% for libro in libros %}
            <li>
                <strong>{{ libro.titulo }}</strong><br>
                <p>{{ libro.descripcion }}</p>

                <div style="margin-top: 10px;">
                    <strong style="font-size: 18px; color:#2c3e50;">¬øQu√© desea realizar con este libro?</strong>
                    <div style="margin-top: 10px; display: flex; gap: 12px; flex-wrap: wrap;">
                        {% if libro.estado_real == "Disponible" %}
                            <a href="{% url 'formulario_prestamo' libro.id %}" class="boton-libro prestamo-btn">üìò Pr√©stamo</a>
                            <a href="{% url 'formulario_reserva' libro.id %}" class="boton-libro reserva-btn">üìó Reserva</a>
                        {% else %}
                            <div class="mensaje-no-disponible">
                                ‚ùå No se puede prestar ni reservar en este momento, int√©ntalo m√°s tarde.
                            </div>
                        {% endif %}
                    </div>
                </div>

                <span>
                    üìñ {{ libro.autor.nombre }} |
                    üè∑Ô∏è {% if libro.categoria %}{{ libro.categoria.nombre }}{% else %}Sin categor√≠a{% endif %} |
                    üè¢ {% if libro.editorial %}{{ libro.editorial.nombre }}{% else %}Sin editorial{% endif %} - 
                    {% if libro.estado_real == "Disponible" %}
                        <span class="estado-disponible">‚úÖ Disponible</span>
                    {% else %}
                        <span class="estado-no">‚ùå No disponible</span>
                    {% endif %}
                </span>
            </li>
        {% empty %}
            <li>No hay libros registrados.</li>
        {% endfor %}
    </ul>

    <a href="{% url 'principal' %}" class="back-link">‚¨Ö Volver a Principal</a>
</div>
</body>
</html>
