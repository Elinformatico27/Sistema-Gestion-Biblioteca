{% extends 'hola/base.html' %}
{% load static %}

{% block title %}üìä Reportes - Estad√≠sticas{% endblock %}

{% block content %}
<style>
  /* ===================== Contenedor general ===================== */
  .reports-wrap {
    margin-top: 24px;
    margin-bottom: 40px;
  }

  /* ===================== Tarjetas de m√©tricas ===================== */
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 18px;
  }

  .metric-card {
    background: linear-gradient(180deg, #ffffff, #fbfbfb);
    border-radius: 12px;
    padding: 18px;
    box-shadow: 0 6px 18px rgba(15,32,39,0.06);
    transition: transform .18s ease, box-shadow .18s ease;
    text-align: center;
  }

  .metric-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 14px 30px rgba(15,32,39,0.09);
  }

  .metric-label {
    display:block;
    font-size:0.95rem;
    color:#374151;
    margin-bottom:8px;
    font-weight:600;
  }

  .metric-value {
    font-size:2rem;
    color:#0f1724;
    font-weight:800;
  }

  /* ===================== Listas Top ===================== */
  .top-lists {
    margin-top: 22px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 18px;
  }

  .top-list {
    background: #ffffff;
    border-radius: 10px;
    padding: 14px;
    box-shadow: 0 6px 14px rgba(15,32,39,0.04);
  }

  .top-list h4 {
    margin-bottom:12px;
    font-size:1rem;
    color:#0f1724;
  }

  .top-list ul {
    list-style: none;
    padding:0;
    margin:0;
  }

  .top-list li {
    padding:10px 8px;
    border-radius:8px;
    margin-bottom:8px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    background: linear-gradient(90deg, rgba(255,255,255,1), rgba(250,250,252,1));
    border-left: 6px solid transparent;
  }

  .top-list li:nth-child(odd) { background:#fbfcff; }
  .top-count {
    font-weight:700;
    color:#111827;
  }

  /* ===================== Est√©tica general ===================== */
  h2.section-title {
    font-size:1.4rem;
    color:#0f1724;
    margin-bottom:6px;
    font-weight:700;
  }

  p.section-sub {
    color:#6b7280;
    margin-bottom:14px;
  }

  /* Responsive adjustments */
  @media (max-width: 720px) {
    .top-lists { grid-template-columns: 1fr; }
  }
</style>

<div class="reports-wrap container">
  <h2 class="section-title">üìä Panel de Reportes</h2>
  <p class="section-sub">Resumen visual y tablas r√°pidas con los principales indicadores del sistema.</p>

  <!-- ===================== TARJETAS DE M√âTRICAS ===================== -->
  <div class="metrics-grid">
    <div class="metric-card">
      <span class="metric-label">Total de Pr√©stamos</span>
      <span class="metric-value">{{ total_prestamos }}</span>
    </div>

    <div class="metric-card">
      <span class="metric-label">Total de Reservas</span>
      <span class="metric-value">{{ total_reservas }}</span>
    </div>

    <div class="metric-card">
      <span class="metric-label">Usuarios Registrados</span>
      <span class="metric-value">{{ usuarios_activos }}</span>
    </div>

    <div class="metric-card">
      <span class="metric-label">Libros (Top Prestados)</span>
      <span class="metric-value">{{ top_prestados|length }}</span>
    </div>

    <div class="metric-card">
      <span class="metric-label">Libros (Top Reservados)</span>
      <span class="metric-value">{{ top_reservados|length }}</span>
    </div>
  </div>

  <!-- ===================== LISTAS TOP ===================== -->
  <div class="top-lists">
    <!-- Top Prestados -->
    <div class="top-list">
      <h4>üèÜ Top 5 - Libros m√°s Prestados</h4>
      <ul>
        {% for libro in top_prestados %}
          <li>
            <span>{{ libro.libro__titulo }}</span>
            <span class="top-count">{{ libro.total }}</span>
          </li>
        {% empty %}
          <li>No hay registros de pr√©stamos.</li>
        {% endfor %}
      </ul>
    </div>

    <!-- Top Reservados -->
    <div class="top-list">
      <h4>üìö Top 5 - Libros m√°s Reservados</h4>
      <ul>
        {% for libro in top_reservados %}
          <li>
            <span>{{ libro.libro__titulo }}</span>
            <span class="top-count">{{ libro.total }}</span>
          </li>
        {% empty %}
          <li>No hay registros de reservas.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <!-- ===================== GR√ÅFICO DE BARRAS (Opcional) ===================== -->
  <div class="chart-card">
    <canvas id="prestamosChart"></canvas>
  </div>
</div>

<!-- ===================== Script para gr√°fico con Chart.js ===================== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('prestamosChart').getContext('2d');
  const data = {
    labels: [{% for dia in prestamos_por_dia %}'{{ dia.dia }}',{% endfor %}],
    datasets: [{
      label: 'Pr√©stamos por d√≠a',
      data: [{% for dia in prestamos_por_dia %}{{ dia.total }},{% endfor %}],
      backgroundColor: 'rgba(54, 162, 235, 0.6)',
      borderColor: 'rgba(54, 162, 235, 1)',
      borderWidth: 1
    }]
  };
  const prestamosChart = new Chart(ctx, {
    type: 'bar',
    data: data,
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        title: {
          display: true,
          text: 'Pr√©stamos diarios'
        }
      },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
</script>
{% endblock %}
